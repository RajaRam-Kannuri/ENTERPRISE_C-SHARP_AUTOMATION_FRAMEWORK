{"Value":null,"VariableID":1341181946,"Favorite":false,"UsesSQL":true,"SqlScript":"Use Sufs\r\n\r\nDECLARE @OrganizationYearID INT = 18\r\n\r\n; with Renewal as (\r\n     select \r\n     count(st.householdmemberid) students\r\n     ,hm.householdid\r\n     from dbo.student st\r\n     join dbo.householdmember hm\r\n     on st.householdmemberid = hm.householdmemberid \r\n     where st.StudentTypeID =2 and st.StudentScholarshipStatusID != 16\r\n     and hm.householdid not in (\r\n                                select \r\n                                householdid\r\n                                from student s\r\n                                join householdmember hmb\r\n                                on s.HouseholdMemberID = hmb.HouseholdMemberID\r\n                                where s.StudentTypeID =1\r\n                                )\r\n     group by hm.householdid                                \r\n     )\r\n\r\nSELECT * FROM (SELECT DISTINCT AU.UserName AS 'Email', MS.[Description] AS 'Marital Status', \r\n(SELECT COUNT(1) FROM dbo.HouseholdMember WHERE HouseholdID = H.HouseholdID AND HouseholdMemberTypeID IN (1,2)) AS NumOfParents,\r\nre.students AS NumOfRenewalStudents,\r\n(SELECT COUNT(1) FROM dbo.HouseholdMember WHERE HouseholdID = H.HouseholdID AND HouseholdMemberTypeID = 3) AS NumOfStudents,\r\n(SELECT COUNT(1) FROM dbo.HouseholdMember WHERE HouseholdID = H.HouseholdID AND HouseholdMemberTypeID = 5) AS NumOfOtherAdults,\r\n(SELECT COUNT(1) FROM dbo.HouseholdMember WHERE HouseholdID = H.HouseholdID AND HouseholdMemberTypeID = 4) AS NumOfChildren,\r\n(SELECT COUNT(1) FROM dbo.HouseholdMember WHERE HouseholdID = H.HouseholdID AND (IsFosterChild = 1 OR IsOutOfHome = 1)) AS NumOfFoster, HM.FirstName, GL.[Description] AS 'Grade Level'\r\nFROM dbo.[Application] A\r\nJOIN dbo.Household H ON H.ApplicationID = A.ApplicationID\r\njoin renewal re on h.householdid = re.householdid \r\nJOIN dbo.HouseholdMember Adult ON Adult.HouseholdID = H.HouseholdID AND Adult.HouseholdMemberTypeID = 1\r\nJOIN dbo.MaritalStatus MS ON MS.MaritalStatusID = Adult.MaritalStatusID\r\nJOIN dbo.HouseholdMember HM ON HM.HouseholdID = H.HouseholdID\r\nJOIN dbo.Student S ON S.HouseholdMemberID = HM.HouseholdMemberID\r\nJOIN dbo.GradeLevel GL ON GL.GradeLevelID = S.GradeLevelID\r\nJOIN dbo.UserApplication UA ON UA.ApplicationID = A.ApplicationID\r\nJOIN dbo.UserMap UM ON UA.UserID = UM.UserID\r\nJOIN dbo.aspnet_Users AU ON AU.UserId = UM.UserId_Membership\r\nJOIN dbo.StudentSchool SS ON SS.HouseholdMemberID = S.HouseholdMemberID\r\nJOIN dbo.StudentSchoolVerificationPeriod SSVP ON SSVP.StudentSchoolID = SS.StudentSchoolID \r\nAND SSVP.CertificationStatusID = 2 AND SSVP.IsEnrolled = 1\r\nWHERE A.OrganizationYearID = @OrganizationYearID AND AU.UserName LIKE '%@%' \r\n  AND A.ApplicationStatusID = 23 AND A.ApplicationID NOT IN\r\n  (SELECT PreviousYearApplicationID FROM dbo.[Application] WHERE PreviousYearApplicationID IS NOT NULL)\r\n) AS TEMP\r\n\r\nWHERE NumOfRenewalStudents = 3 AND NumOfStudents = 3 AND NumOfParents = 1\r\nOrder by NEWID()\r\n","SqlServer":"dev-sqlc1n1\\test","SqlServerUAT":null,"SqlServerTraining":"","SqlColumn":"Email","SqlRow":1,"Note":null,"Name":"FTC-OLA_FindRenewalApplicationWith3Students","DateModified":null,"Description":null,"Program":"FTC","Browser":"Chrome","Environment":"Test","ServerEnvironment":"Test"}